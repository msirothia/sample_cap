modules:
  - name: {{appName}}-srv
    type: {{language}}
    path: {{& srvPath}}
    requires:
      - name: {{appName}}-auth
        parameters:
          config:
            credential-type: X509_GENERATED
            app-identifier: srv

  - name: {{appName}}
    type: approuter.nodejs
    path: app/router
    requires:
      - name: {{appName}}-auth
        parameters:
          config:
            credential-type: X509_GENERATED
            app-identifier: approuter

  - name: {{appName}}-mtx
    type: nodejs
    path: gen/mtx/sidecar
    requires:
      - name: {{appName}}-auth
        parameters:
          config:
            credential-type: X509_GENERATED
            app-identifier: mtx

resources:
  - name: {{appName}}-auth
    type: org.cloudfoundry.managed-service
    {{#hasApprouter}}
    requires:
      - name: app-api
    {{/hasApprouter}}
    parameters:
      service: identity
      service-name: {{appName}}-auth
      service-plan: application
      config:
        display-name: {{appName}}
        {{#hasApprouter}}
        oauth2-configuration:
          redirect-uris:
            - ~{app-api/app-protocol}://~{app-api/app-uri}/login/callback
          post-logout-redirect-uris:
            - ~{app-api/app-protocol}://~{app-api/app-uri}/*/logout.html
        {{/hasApprouter}}
        {{#hasAms}}
        authorization:
          enabled: true
        {{/hasAms}}
        {{#hasMultitenancy}}
        multi-tenant: true
        {{/hasMultitenancy}}
        {{#hasXsuaa}}
        xsuaa-cross-consumption: true
        {{/hasXsuaa}}
